# Документация к интерпретатору языка MovDino

## 1. Основные функции

### `clear_screen()`
- **Назначение**: Очищает экран терминала
- **Параметры**: Нет
- **Возвращаемое значение**: Нет
- **Особенности**: 
  - Использует `system("cls")` на Windows
  - Использует `system("clear")` на Unix-системах
  - Вызывается перед выводом нового состояния поля

### `print_field(FILE *out, char **terrain, char **paint, int y, int x, int height, int width, bool to_file)`
- **Назначение**: Выводит текущее состояние игрового поля
- **Параметры**:
  - `out`: файловый поток для вывода
  - `terrain`: массив с объектами поля
  - `paint`: массив с цветами клеток
  - `y, x`: координаты динозавра
  - `height, width`: размеры поля
  - `to_file`: флаг вывода в файл
- **Возвращаемое значение**: Нет
- **Логика отображения**:
  - Позиция динозавра отображается как `#`
  - Окрашенные клетки показывают символ цвета
  - Остальные клетки показывают объекты поля

### `push_state(State **history, int *size, int *cap, char **terr, char **pai, int px, int py, int hh, int ww)`
- **Назначение**: Сохраняет текущее состояние в историю для UNDO
- **Параметры**:
  - `history`: массив состояний
  - `size, cap`: текущий размер и емкость истории
  - `terr, pai`: массивы поля и цветов
  - `px, py`: координаты динозавра
  - `hh, ww`: размеры поля
- **Возвращаемое значение**: Нет
- **Особенности**: Динамически расширяет массив истории при необходимости

### `pop_state(State **history, int *size, char ***terr, char ***pai, int *px, int *py, int hh, int ww)`
- **Назначение**: Восстанавливает предыдущее состояние из истории
- **Параметры**: Аналогично `push_state`
- **Возвращаемое значение**: Нет
- **Особенности**: Не выполняет откат если история пуста или содержит только одно состояние

### `execute_command(char *line, int lnum, char *ctx, ...)`
- **Назначение**: Выполняет одну команду MovDino
- **Параметры**:
  - `line`: строка с командой
  - `lnum`: номер строки для сообщений об ошибках
  - `ctx`: контекст (имя файла)
  - Остальные параметры - состояние игры
- **Возвращаемое значение**: `true` при успехе, `false` при ошибке
- **Поддерживаемые команды**:
  - `MOVE`: перемещение динозавра
  - `PAINT`: покраска клетки
  - `DIG`: создание ямы
  - `MOUND`: создание горы
  - `JUMP`: прыжок на N клеток
  - `GROW`: создание дерева
  - `CUT`: удаление дерева
  - `MAKE`: создание камня
  - `PUSH`: перемещение камня
  - `EXEC`: выполнение команд из файла
  - `IF CELL`: условное выполнение
  - `UNDO`: откат состояния

### `main(int argc, char *argv[])`
- **Назначение**: Точка входа программы
- **Параметры**: Стандартные аргументы командной строки
- **Логика работы**:
  1. Обработка аргументов командной строки
  2. Чтение и парсинг входного файла
  3. Инициализация поля и состояния
  4. Выполнение команд
  5. Сохранение результата

## 2. Основные переменные, указатели и библиотеки

### Библиотеки:
- `stdio.h`, `stdlib.h`, `string.h`: стандартные функции ввода-вывода и работы со строками
- `unistd.h`: для функции `sleep()`
- `stdbool.h`: для типа `bool`
- `windows.h`: для Windows-специфичных функций

### Структуры данных:
```c
typedef struct {
    char **terrain;  // 2D массив объектов поля
    char **paint;    // 2D массив цветов клеток  
    int x, y;        // координаты динозавра
} State;
```

### Основные переменные в `main()`:
- `terrain`, `paint`: динамические массивы для хранения состояния поля
- `width`, `height`: размеры игрового поля
- `x`, `y`: текущие координаты динозавра
- `history`: массив состояний для реализации UNDO
- `hsize`, `hcap`: размер и емкость истории

## 3. Основная концепция кода

### Архитектура:
Программа представляет собой интерпретатор языка MovDino, который:
1. **Читает команды** из текстового файла
2. **Обрабатывает состояние** игрового поля и динозавра
3. **Визуализирует** изменения в реальном времени
4. **Сохраняет** конечный результат

### Ключевые особенности:
- **Тороидальная топология**: при выходе за границы динозавр появляется с противоположной стороны
- **Система истории**: поддерживает многоуровневый откат команд (UNDO)
- **Рекурсивное выполнение**: команда `EXEC` позволяет выполнять вложенные файлы
- **Условные команды**: `IF CELL` проверяет состояние клетки перед выполнением
- **Кроссплатформенность**: работает на Windows и Linux

### Обработка ошибок:
- Проверка синтаксиса команд
- Валидация координат и направлений
- Обработка конфликтов с препятствиями
- Информативные сообщения об ошибках с указанием строки

## 4. Соответствие ТЗ

### Реализованные требования из ТЗ:

**Часть 1 - Базовое перемещение:**
- Команды `SIZE`, `START`, `MOVE`
- Тороидальная топология поля

**Часть 2 - Препятствия и покраска:**
- Команды `PAINT`, `DIG`, `MOUND`
- Обработка ям и гор

**Часть 3 - Прыжки:**
- Команда `JUMP` с проверкой препятствий

**Часть 4 - Формат команд:**
-  Парсинг комментариев `//`
-  Проверка отступов и синтаксиса
-  Валидация последовательности команд

**Часть 5 - Визуализация:**
-  Опции `interval`, `no-display`, `no-save`
-  Кроссплатформенная очистка экрана

**Часть 6 - Дополнительные объекты:**
-  Деревья (`GROW`, `CUT`)
-  Камни (`MAKE`, `PUSH`)
-  Команда `EXEC` для вложенных файлов
-  Команда `LOAD` для загрузки состояния

**Часть 7 - Управление состояниями:**
-  Система истории состояний
-  Команда `UNDO`
-  Условные команды `IF CELL`

### Нефункциональные требования:
-  Размер поля 10×100 до 100×100
-  Эффективная обработка больших файлов
-  Кроссплатформенность (Linux/Windows)
-  Структурированный код с модульностью

Программа полностью реализует спецификацию языка MovDino, предоставляя полнофункциональный интерпретатор для управления динозавром на игровом поле с поддержкой всех заявленных команд и возможностей.
